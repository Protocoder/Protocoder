function qq(e){for(var t="",o=new Uint8Array(e),n=o.byteLength,i=0;n>i;i++)t+=String.fromCharCode(o[i]);return window.btoa(t)}var Dashboard=function(e){this.protoEvent=e.event,this.widgets=[],this.status=!1,this.keyId=null,this.keybinded=!1,this.widgetsFn={},that=this,$("#overlay #container").keydown(function(e){that.keybinded&&ws.send("{type:key, id:"+that.keyId+", val:"+e.keyCode+"}")}),this.init()};Dashboard.prototype.initEvents=function(){var e=this;this.protoEvent.listen("runProject",function(){e.removeWidgets()}),this.protoEvent.listen("dashboard",function(t){var o=t.detail;"showDashboard"==o.action?1==o.values.val?e.visible(!0):e.visible(!1):"add"==o.action?e.widgetsFn[o.values.id]=e.addWidget(o.values):"update"==o.action?e.widgetsFn[o.values.id](o.values.val,""):"setLabelText"==o.action?e.setLabelText(o.values.id,o.values.val):"changeImage"==o.action?e.changeImage(o.values.id,o.values.url):"updateCamera"==o.action&&e.updateCamera(o.values.id,o.values.src)}),this.protoEvent.listen("dashboard_removeWidgets",function(){e.removeWidgets()}),this.protoEvent.listen("dashboard_visible",function(t){e.visible(t.detail)}),this.protoEvent.listen("dashboard_toggle",function(){e.toggle()})},Dashboard.prototype.init=function(){this.initEvents()},Dashboard.prototype.visible=function(e){e?($("#overlay > #container").addClass("on"),$("body > #container").addClass("off"),$("body > #toolbar").addClass("off"),$("#overlay #toggle").addClass("on"),this.status=!0):($("#overlay > #container").removeClass("on"),this.status=!1,$("#overlay #toggle").removeClass("on"),$("body > #container").removeClass("off"),$("body > #toolbar").removeClass("off"))},Dashboard.prototype.toggle=function(){0==this.status?this.show():this.hide()},Dashboard.prototype.addWidget=function(e){return this.widgets.push(e.id),"plot"==e.type?this.addPlot(e.id,e.name,e.x,e.y,e.w,e.h,e.minLimit,e.maxLimit):"button"==e.type?this.addButton(e.id,e.name,e.x,e.y,e.w,e.h):"slider"==e.type?this.addSlider(e.id,e.name,e.x,e.y,e.w,e.h,e.min,e.max):"label"==e.type?this.addLabel(e.id,e.name,e.x,e.y,e.w,e.h,e.size,e.color):"input"==e.type?this.addInput(e.id,e.name,e.x,e.y,e.w,e.h):"image"==e.type?this.addImage(e.id,e.url,e.x,e.y,e.w,e.h):"html"==e.type?this.addHTML(e.id,e.html,e.x,e.y):"background"==e.type?this.setBackgroundColor(e.r,e.g,e.b,e.a):"camera"==e.type?this.addCameraPreview(e.id,e.x,e.y,e.w,e.h):"custom"==e.type?this.addCustom(e.id,e.x,e.y,e.w,e.h):("keyevent"==e.type&&(this.keyId=e.id,this.keybinded=e.enabled),void 0)},Dashboard.prototype.removeWidgets=function(){var e=this;$.each(this.widgets,function(t,o){$("#overlay #container #"+o).remove(),e.widgets.pop(o)}),$("#overlay #container").empty()},Dashboard.prototype.addHTML=function(e,t,o,n){$('<div class ="widget chtml" id = "html_'+e+'">'+t+" </div>").appendTo("#overlay #container").css({top:n+"px",left:o+"px"})},Dashboard.prototype.addLabel=function(e,t,o,n,i,a,r,s){$('<div class ="widget label" id = "label_'+e+'">'+t+" </div>").appendTo("#overlay #container").css({"font-size":r+"px",color:s,top:n+"px",left:o+"px",width:i+"px",height:a+"px"}).draggable()},Dashboard.prototype.setLabelText=function(e,t){$("#overlay #container #label_"+e).text(t)},Dashboard.prototype.changeImage=function(e,t){var o=$("#overlay #container #image_"+e);o.attr("src",t)},Dashboard.prototype.addImage=function(e,t,o,n,i,a){-1==t.indexOf("http")&&(t=window.location.origin+"/apps/"+currentProject.type+"/"+currentProject.name+"/"+t),$('<img src = "'+t+'" class ="widget image" id = "image_'+e+'"/>').appendTo("#overlay #container").css({width:i+"px",height:a+"px",top:n+"px",left:o+"px"}).draggable()},Dashboard.prototype.addSlider=function(e,t,o,n,i,a,r,s){$('<div class = "widget slider" id = "slider_'+e+'"> <span>'+t+"</span> </div>").appendTo("#overlay #container").css({top:n+"px",left:o+"px"}),$("#overlay #container #slider_"+e+" input").css({width:i+"px",height:a+"px"}),$('<input type="range" min="'+r+'" max="'+s+'" class ="widget"> </input>').appendTo("#slider_"+e).change(function(){ws.send("{type:slider, id:"+e+", val:"+this.value+"}")})},Dashboard.prototype.addInput=function(e,t,o,n,i,a){function r(){var t=$("#container #text_input_"+e+" input").val(),o={type:"text_input",id:e,val:t};ws.send(JSON.stringify(o)),$("#container #text_input_"+e+" input").val("")}$('<div class = "widget text_input" id = "text_input_'+e+'"> <span>'+t+"</span> </div>").appendTo("#overlay #container").css({top:n+"px",left:o+"px"}),$("#overlay #container #text_input_"+e+" input").css({width:i+"px",height:a+"px"}),$("#container #text_input_"+e+" input").on("keypress",function(e){13==(e.keyCode||e.which)&&r()}),$('<input class ="widget"> </input><button><i class = "fa fa-circle-o"></i></button>').appendTo("#text_input_"+e),$("#container #text_input_"+e+" button").click(function(){r()})},Dashboard.prototype.addButton=function(e,t,o,n,i,a){$('<button class ="widget" id = "button_'+e+'">'+t+" </button>").appendTo("#overlay #container").css({width:i+"px",height:a+"px",top:n+"px",left:o+"px"}).click(function(){ws.send("{type:button, id:"+e+"}")})},Dashboard.prototype.addCustom=function(e,t,o,n,i){return $('<div class ="widget" id = "custom_'+e+'"> </div>').appendTo("#overlay #container").css({width:n+"px",height:i+"px",top:o+"px",left:t+"px"}),function(t){ws.send("{type:custom, id:"+e+", val:"+t+"}")}},Dashboard.prototype.addCameraPreview=function(e,t,o,n,i){console.log("addCameraPreview "+e),$('<canvas class ="widget" id = "camera_'+e+'"> </canvas>').appendTo("#overlay #container").css({width:n+"px",height:i+"px",top:o+"px",left:t+"px"})},Dashboard.prototype.updateCamera=function(e,t){console.log("updateCamera "+e);var o=document.getElementById("camera_"+e);if(o.getContext){var n=o.getContext("2d"),i=new Image;i.onload=function(){n.drawImage(this,0,0,this.width,this.height)},i.onerror=function(e){console.log("Img Onerror:",e)},i.src="data:image/jpeg;base64,"+t}},Dashboard.prototype.setBackgroundColor=function(e,t,o,n){$("#overlay #container").css("background","rgba("+e+","+t+","+o+","+n+")")},Dashboard.prototype.addPlot=function(e,t,o,n,i,a,r,s){var c,d,p=10,l=500,u=!0,h=r,m=s,v=l||40,f=p||500,y=d3.range(v).map(function(){return 0}),g={top:10,right:10,bottom:20,left:10},b=(i||350)-g.left-g.right,_=(a||250)-g.top-g.bottom,w=d3.scale.linear().domain([0,v-1]).range([0,b]),E=d3.scale.linear().domain([-1,1]).range([_,0]),C=d3.svg.area().interpolate("cardinal").y0(_).x(function(e,t){return w(t)}).y(function(e){return E(e)});$("#overlay #container").append('<div class ="plot_container widget" id = "'+e+'"><h1> '+t+' </h1><div id = "plot"> </div></div>'),$("#"+e).draggable();var x=d3.select("#"+e).append("svg").attr("width",b+g.left+g.right).attr("height",_+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")");x.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",b).attr("height",_),x.append("g").attr("class","x axis").attr("transform","translate(0,"+_+")"),x.append("g").attr("class","y axis");var j=x.append("g").attr("clip-path","url(#clip)").append("path").data([y]).attr("class","line").attr("d",C);return console.log("#plot_container#"+e+" "+o+" "+n),$(".plot_container#"+e).css({left:o,top:n}),function(e,t){e&&(u&&(c=e,d=e,u=!1),y.push(e),c>e?c=e:d=e,w.domain([0,v-1]),E.domain([h,m]),j.attr("d",C).attr("transform",null).transition().duration(f).ease("linear").attr("transform","translate("+w(-1)+")").attr("end",t),y.shift())}};var Communication=function(e,t){this.protoEvent=e.event,this.remoteIP=window.location.hostname,this.remoteWSPORT="8587",this.self=this,this.countLogs=0,t&&this.initWebsockets(),this.init()};Communication.prototype.initEvents=function(){var e=this;this.protoEvent.listen("runApp",function(t){e.runApp(t.detail)}),this.protoEvent.listen("communication_pushCodeAndRun",function(t){console.log(t),e.pushCodeAndRun(t.detail)}),this.protoEvent.listen("saveProject",function(t){e.pushCode(t.detail.currentProject,t.detail.fileName)}),this.protoEvent.listen("liveExecute",function(t){e.executeCode(t.detail)}),this.protoEvent.listen("createNewProject",function(t){e.createNewProject(t.detail)}),this.protoEvent.listen("listFilesInProject",function(t){e.listFilesInProject(t.detail)}),this.protoEvent.listen("renameProject",function(t){e.renameApp(t.detail)}),this.protoEvent.listen("removeApp",function(t){e.removeApp(t.detail)}),this.protoEvent.listen("deviceProjectHighlight",function(t){e.highlight(t.filter,t.detail.name)}),this.protoEvent.listen("fetchCode",function(t){e.fetchCode(t.detail.name,t.detail.type)})},Communication.prototype.init=function(){this.initEvents()},Communication.prototype.listApps=function(e){var t=this,o={};o.cmd="list_apps",o.filter=e,$.get(this.remoteIP+"cmd="+JSON.stringify(o),function(o){t.protoEvent.send("projects_received",{filter:e,data:JSON.parse(o)})})},Communication.prototype.pushCode=function(e,t){var o={};o.cmd="push_code";var n={};n.name=e.name,n.url=e.url,n.code=e.code,n.type=e.type,n.fileName=t?t:"main.js",$.ajax({url:this.remoteIP+"cmd="+JSON.stringify(o),type:"post",data:n,success:function(){}})},Communication.prototype.pushCodeAndRun=function(e){var t={};t.cmd="push_code_and_run",console.log(e),project=e.currentProject,fileName=e.fileName,console.log(project+" "+fileName);var o={};o.name=project.name,o.url=project.url,o.remoteIP=this.remoteIP,o.type=project.type,o.code=project.code,o.fileName=fileName?fileName:"main.js",$.ajax({url:this.remoteIP+"cmd="+JSON.stringify(t),type:"post",data:o,success:function(){}}),$("#console_wrapper #console").empty(),this.countLogs=0},Communication.prototype.executeCode=function(e){var t={};t.cmd="execute_code";var o={};o.code=e,o.codeToSend=e,$.ajax({url:this.remoteIP+"cmd="+JSON.stringify(t),type:"post",data:o,success:function(){}})},Communication.prototype.fetchCode=function(e,t){var o=this,n={};n.cmd="fetch_code",n.name=e,n.type=t;try{$.get(this.remoteIP+"cmd="+JSON.stringify(n),function(n){var i=JSON.parse(n);currentProject.name=e,currentProject.type=t,currentProject.url=location.href+"apps/"+t+"/"+e+"/",document.title=" protocoder | "+e;var i=unescape(i.code);o.protoEvent.send("ui_setMainTab",{pName:e,code:i}),o.listFilesInProject(currentProject)})}catch(i){}},Communication.prototype.listFilesInProject=function(e){var t=this,o={};o.cmd="list_files_in_project",o.name=e.name,o.type=e.type;try{$.get(this.remoteIP+"cmd="+JSON.stringify(o),function(e){t.protoEvent.send("ui_clearFileElements"),$.each(JSON.parse(e).files,function(e,o){o.recid=e,t.protoEvent.send("ui_addFileElement",o)})})}catch(n){}},Communication.prototype.runApp=function(e){var t={};t.cmd="run_app",t.name=e.name,t.url=e.url,t.remoteIP=this.remoteIP,t.type=e.type;try{$.get(this.remoteIP+"cmd="+JSON.stringify(t),function(){})}catch(o){}$("#console_wrapper #console").empty(),this.countLogs=0},Communication.prototype.createNewProject=function(e){var t={};t.cmd="create_new_project",t.name=e,console.log(t);var o=this;try{$.get(this.remoteIP+"cmd="+JSON.stringify(t),function(){o.listApps("projects"),o.fetchCode(t.name,"projects")})}catch(n){}},Communication.prototype.removeApp=function(e){var t=this,o={};o.cmd="remove_app",o.name=e.name,o.type=e.type;try{$.get(this.remoteIP+"cmd="+JSON.stringify(o),function(e){t.listApps("projects"),alert("app removed "+e)})}catch(n){}},Communication.prototype.renameApp=function(e){var t={};t.cmd="rename_app",t.name=e.name,t.type=e.type;try{$.get(this.remoteIP+"cmd="+JSON.stringify(t),function(e){alert("rename"+e)})}catch(o){}},Communication.prototype.getReference=function(){var e=this,t={};t.cmd="get_documentation",$.get(this.remoteIP+"cmd="+JSON.stringify(t),function(t){var o=JSON.parse(t);e.protoEvent.send("reference_parseHelp",{docApi:o.api})})};var ws;Communication.prototype.initWebsockets=function(){var that=this;ws=new WebSocket("ws://"+this.remoteIP+":"+this.remoteWSPORT);var self=this;ws.onopen=function(){self.connected()},ws.onmessage=function(e){if("Connected"!=e.data){var result=JSON.parse(e.data);if("log_event"==result.type,null!=result.projects){console.log("got projects");var projects=result.projects;setProjects(projects)}if(null!=result.code&&this.protoEvent.send("editor_setCode",{code:result.code}),null!=result.project,"error"==result.type){currentError=result.values,$("#console_wrapper #console").append("<p class ='error'> "+currentError+" </p>");var c=$("#console_wrapper #console")[0];c.scrollTop=c.scrollHeight}if("console"==result.type)if("log"==result.action){var val="<p>"+result.values.val+"</p>";that.protoEvent.send("consoleLog",{log:val})}else if("logC"==result.action){var val='<p style ="color:'+result.values.color+'">'+result.values.val+"</p>";that.protoEvent.send("consoleLog",{log:val})}else"clear"==result.action?($("#console_wrapper #console").empty(),self.countLogs=0):"backgroundColor"==result.action?$("#console_wrapper").css("background-color",result.values.color):"textColor"==result.action?$("<style>#console p { color: "+result.values.textColor+"; }</style>").appendTo("head"):"textSize"==result.action?$("<style>#console p { font-size: "+result.values.textSize+"; }</style>").appendTo("head"):"show"==result.action&&(1==result.values.val?$("#console_wrapper").show():$("#console_wrapper").hide());"ide"==result.type&&("ready"==result.action?result.values.ready?that.protoEvent.send("ui_appRunning",!0):that.protoEvent.send("ui_appRunning",!1):"new_files_in_project"==result.action?self.listFilesInProject(currentProject.name,currentProject.type):"customjs"==result.action&&eval(result.values.val)),"widget"==result.type&&that.protoEvent.send("dashboard",result)}},ws.onclose=function(){self.disconnected()}};var reconnectionInterval;Communication.prototype.connected=function(){clearInterval(reconnectionInterval),this.protoEvent.send("ui_appConnected",!0)},Communication.prototype.disconnected=function(){var e=this;this.protoEvent.send("ui_appConnected",!1),reconnectionInterval=setTimeout(function(){e.initWebsockets()},1e3)};var currentProject=[];Communication.prototype.getCodeFor=function(e){ws.send('{type:get_code, name:"'+e+'"}')},Communication.prototype.highlight=function(e,t){ws.send('{id: "protocoderApp", type:"project_highlight", folder:"'+e+'", name:"'+t+'"}')},Communication.prototype.saveCode=function(){var e={};e.type="save_file",e.name=currentProject.name,e.code=unescape(editor.getValue()),ws.send(JSON.stringify(e))};var Editor=function(e){this.protoEvent=e.event,this.liveExecRec={liveExecHistory:[],firstTime:null},this.init()};Editor.prototype.initEvents=function(){var e=this;e.protoEvent.listen("editor_resize",function(){e.editor.resize()}),e.protoEvent.listen("editor_setTypeAndCode",function(t){e.setTypeAndCode(t.detail.type,t.detail.code)}),e.protoEvent.listen("editor_saveCode",function(){e.saveCode()}),e.protoEvent.listen("editor_setCode",function(t){e.setCode(t.detail.code)}),e.protoEvent.listen("editor_insert",function(t){e.editor.insert(t.detail)}),e.protoEvent.listen("editor_runApp",function(){e.pushCodeAndRun()})},Editor.prototype.init=function(){var e=this,t=ace.edit("editor");this.editor=t;var o=t.getSession();this.session=o,ace.require("ace/lib/fixoldbrowsers"),o.setMode("ace/mode/javascript");var n=ace.require("ace/config");ace.require("ace/edit_session"),ace.require("ace/undomanager"),ace.require("ace/marker"),ace.require("ace/range"),this.Range=ace.require("ace/range").Range,ace.require("ace/lib/event"),ace.require("ace/theme/textmate"),ace.require("ace/ext/language_tools");var i=t.renderer;o.setWrapLimitRange(null,null),i.setShowPrintMargin=null,t.setPrintMarginColumn(!1),t.setFontSize(14),i.setPadding(8),t.setOptions({enableBasicAutocompletion:!0}),o.on("change",function(){0!=e.isSaved&&(e.protoEvent.send("ui_setTabFeedback",!0),e.isSaved=!0)}),t.commands.addCommand({name:"save_command",bindKey:{win:"Ctrl-S",mac:"Command-S",sender:"editor|cli"},exec:function(){e.saveCode()}}),t.commands.addCommand({name:"run_command",bindKey:{win:"Ctrl-R",mac:"Command-R",sender:"editor|cli"},exec:function(){currentProject.code=o.getValue(),e.pushCodeAndRun()}}),t.commands.addCommand({name:"show_hide_dashboard",bindKey:{win:"Ctrl-Shift-D",mac:"Command-Shift-D",sender:"editor"},exec:function(){e.protoEvent.send("dashboard_toggle")}}),t.commands.addCommand({name:"showKeyboardShortcuts",bindKey:{win:"Ctrl-Alt-h",mac:"Command-Alt-h"},exec:function(e){n.loadModule("ace/ext/keybinding_menu",function(t){t.init(e),e.showKeyboardShortcuts()})}}),t.commands.addCommand({name:"snippet",bindKey:{win:"Alt-C",mac:"Command-Alt-C"},exec:function(e,t){if("object"==typeof t)return e.cmdLine.setValue("snippet ",1),e.cmdLine.focus(),void 0;var o=snippetManager.getSnippetByName(t,e);o&&snippetManager.insertSnippet(e,o.content)},readOnly:!0}),t.commands.addCommand({name:"increaseFontSize",bindKey:"Ctrl-+",exec:function(e){var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(t+1)}}),t.commands.addCommand({name:"decreaseFontSize",bindKey:"Ctrl+-",exec:function(e){var t=parseInt(e.getFontSize(),10)||12;e.setFontSize(Math.max(t-1||1))}}),t.commands.addCommand({name:"liveExecution",bindKey:{win:"Ctrl-Shift-X",mac:"Command-Shift-X",sender:"mmeditor"},exec:function(){var n=t.getSelection().getRange(),i=o.getTextRange(n),a={},r=(new Date).getTime();if(a.time=r,null==e.liveExecRec.firstTime&&(e.liveExecRec.firstTime=r),a.selectedText=i,i.length>0)a.range=n;else{var s=t.getCursorPosition(),c=s.row;a.numLine=c}e.runLiveExec(a),e.liveExecRec.liveExecHistory.push(a)}}),t.commands.addCommand({name:"playLiveExec",bindKey:{win:"Ctrl-Shift-1",mac:"Command-Shift-1",sender:"mmeditor"},exec:function(){e.playLiveExec(!1)}}),t.commands.addCommand({name:"playLiveExec",bindKey:{win:"Ctrl-Shift-2",mac:"Command-Shift-2",sender:"mmeditor"},exec:function(){e.playLiveExec(!0)}}),t.commands.addCommand({name:"playLiveExec",bindKey:{win:"Ctrl-Shift-0",mac:"Command-Shift-0",sender:"mmeditor"},exec:e.clearLiveExecRec}),this.initEvents()},Editor.prototype.runLiveExec=function(e){if(e.selectedText.length>0)this.protoEvent.send("liveExecute",e.selectedText),this.highlight(e.range);else{var t=this.session.getDocument().$lines[e.numLine],o=new this.Range(e.numLine,0,e.numLine,t.length);t.length>0&&(this.protoEvent.send("liveExecute",t),this.highlight(o))}},Editor.prototype.clearLiveExecRec=function(){this.liveExecRec.firstTime=null,this.liveExecRec.liveExecHistory=[]},Editor.prototype.playLiveExec=function(){for(var e=this.liveExecRec.liveExecHistory,t=this.liveExecRec.firstTime,o=0;e.length>o;o++)(function(o){var n=Math.abs(t-e[o].time);console.log(n),setTimeout(function(){that.protoEvent.send("liveExecute",e[o])},n)})(o)},Editor.prototype.highlight=function(e){var t=this,o=this.session.addMarker(e,"run_code","fullLine");setTimeout(function(){t.session.removeMarker(o)},500)},Editor.prototype.showErrors=function(){this.session.setAnnotations([{row:1,column:0,text:"message",type:"error"}])},Editor.prototype.setTypeAndCode=function(e,t){this.setCode(t),this.setType(e)},Editor.prototype.setCode=function(e){this.session.setValue(e)},Editor.prototype.pushCodeAndRun=function(){currentProject.code=this.session.getValue(),that.protoEvent.send("communication_pushCodeAndRun",{currentProject:currentProject,fileName:"main.js"}),that.protoEvent.send("dashboard_removeWidgets"),that.protoEvent.send("runApp",currentProject)},Editor.prototype.saveCode=function(){currentProject.code=this.session.getValue();var e=protocoder.ui.getActiveTab();console.log(e.name),e&&(this.protoEvent.send("saveProject",{currentProject:currentProject,tabName:e.name}),this.isSaved=!0)},Editor.prototype.setType=function(e){var t=e.split(".").pop();switch(t){case"js":this.session.setMode("ace/mode/javascript");break;case"html":this.session.setMode("ace/mode/html");break;case"htm":this.session.setMode("ace/mode/html")}};var Event=function(){};Event.prototype.listen=function(e,t){document.addEventListener(e,t)},Event.prototype.remove=function(e,t){document.removeEventListener(e,t,!1)},Event.prototype.send=function(e,t){var o={};o.detail=t,o.bubbles=!1,o.cancelable=!0;var n=new CustomEvent(e,o);document.dispatchEvent(n)};var Protocoder=function(){};Protocoder.prototype.init=function(){this.event=new Event,this.communication=new Communication(this,!0),this.communication.listApps("projects"),this.communication.listApps("examples"),this.ui=new Ui(this),this.editor=new Editor(this),this.dashboard=new Dashboard(this),this.reference=new Reference(this),this.communication.getReference(this)};var Reference=function(e){this.protoEvent=e.event,this.selectedClass="none",this.init()};Reference.prototype.initEvents=function(){var e=this;e.protoEvent.listen("reference_parseHelp",function(t){e.parseHelp(t.detail.docApi)}),e.protoEvent.listen("reference_",function(){}),e.protoEvent.listen("reference_",function(){})},Reference.prototype.init=function(){this.initEvents()},Reference.prototype.parseHelp=function(e){var t=this;this.doc=JSON.parse(e).apiClasses,this.index=lunr(function(){this.field("class",{boost:10}),this.field("method",{boost:10}),this.field("description"),this.field("example"),this.ref("id")}),this.countReturns=0;var o="#sidebar_container";$(o).load("reference2.html",function(){$("#search input").on("input",function(){var e=$(this).val();if(""!=e){var o=t.index.search(e);$("#search_result").show(),$("#browser").hide(),$("#search_result .methods").empty(),$("#class_"+t.selectedClass).hide(),$.each(o,function(e,o){var n=t.searchById(o.ref);t.insertMethodInCard(n,"#search_result .methods")})}else $("#search_result").hide(),$("#browser").show()}),$("#search_result #close").click(function(){$("#search_result").hide(),$("#browser").show()}),$.each(t.doc,function(e,n){var i,a=n.name;i=n.isMainObject?"#primary":"#secondary",$('<a class = "obj" target="_self">'+a+"</a>").appendTo(o+" #ref_container "+i).click(function(){$("#class_"+a).show(),t.selectedClass=a,$("#browser").hide()}),$(o+" #ref_container #api_class_details").append('<div id = "class_'+a+'" class = "api_class"><div id = "title"><h2>'+a+'</h2></div> <div class = "methods"> </div></div>'),$('<i id = "close" class = "fa fa-times"></i>').appendTo("#class_"+a+" #title").click(function(){$("#class_"+a).hide(),$("#api_class_backdrop").hide(),$("#browser").show()}),$.each(n.apiMethods,function(e,n){var i=n;t.index.add(i),t.insertMethodInCard(i,o+" #ref_container #class_"+i.parent+" .methods")})})})},Reference.prototype.insertMethodInCard=function(e,t){var o=$('<div id ="method_'+e.name+'" title = "'+e.description+'" class = "APImethod"></div>');$(t).append(o);var n="";e.parametersName!==void 0&&(n=e.parametersName.join(", ")),"void"==e.returnType&&(e.returnType=""),$(t+" #method_"+e.name).append('<h3><span id = "returnType">'+e.returnType+" </span><strong>"+e.parent+"."+e.name+'</strong><i>(<span id = "params">'+n+"</span>)</i></h3>"),void 0!=e.description&&$("#method_"+e.name).append('<p id = "description"> '+e.description+" </p>"),void 0!=e.example&&$("#method_"+e.name).append('<p id = "example"> here goes example </p>'),that=this,o.click(function(){var t="";""!=e.returnType&&(t="var var"+that.countReturns++ +" = ");var o=n.replace(")","){ \n\n}");that.protoEvent.send("editor_insert",t+""+e.parent+"."+e.name+"("+o+");"+"\n\n")})},Reference.prototype.searchById=function(e){for(var t=0;this.doc.length>t;t++)for(var o=this.doc[t].apiMethods,n=0;o.length>n;n++)if(e==o[n].id)return o[n]};var SETTINGS={appUrl:"",maxUploads:10},Ui=function(e){this.protoEvent=e.event,this.dropboxEnabled=!0,this.gridRendered=!1,this.tabs={},this.activeTab=null,this.tabId=0,this.init()};Ui.prototype.initEvents=function(){var e=this;this.protoEvent.listen("ui_setMainTab",function(t){e.setMainTab(t.detail.pName,t.detail.code)}),this.protoEvent.listen("ui_setTabFeedback",function(t){e.setTabFeedback(t.detail)}),this.protoEvent.listen("ui_clearFileElements",function(){e.clearFileElements()}),this.protoEvent.listen("ui_addFileElement",function(t){e.addFileElement(t.detail)}),this.protoEvent.listen("consoleLog",function(t){e.consoleLog(t.detail.log)}),this.protoEvent.listen("ui_appConnected",function(t){e.appConnected(t.detail)}),this.protoEvent.listen("ui_appRunning",function(t){e.appRunning(t.detail)}),this.protoEvent.listen("saveProject",function(){e.toolbarFeedback("save")}),this.protoEvent.listen("runProject",function(){e.toolbarFeedback("run")}),this.protoEvent.listen("projects_received",function(t){e.setProjectList(t.detail.filter,t.detail.data)})},Ui.prototype.init=function(){function e(){$().w2form({name:"foo",style:"border: 0px; background-color: transparent;",formHTML:'<div class="w2ui-page page-0">   <div class="w2ui-label"> Name:</div>   <div class="w2ui-field">       <input name="project_name" type="text" size="35"/>   </div></div><div class="w2ui-buttons">   <input type="button" value="OK" name="save">   <input type="button" value="Cancel" name="cancel"></div>',fields:[{name:"project_name",type:"text",required:!0}],record:{first_name:":)"},actions:{save:function(){t.protoEvent.send("createNewProject",$("input#project_name").val()),$().w2popup("close")},cancel:function(){this.clear(),$().w2popup("close")}}}),$().w2popup("open",{title:"Create a new project",body:'<div id="form" style="width: 100%; height: 100%;"></div>',style:"padding: 15px 0px 0px 0px",width:400,height:200,onOpen:function(){$("#w2ui-popup #form").w2render("foo")}})}var t=this;$("#layout").w2layout({name:"layout",panels:[{type:"main",content:"main"},{type:"right",size:300,content:"right",resizable:!0,hidden:!1}],onRender:function(){0==t.gridRendered&&(t.gridRendered=!0,$("#layout_code_editor_panel_main").append('<div id="tabMenu"><i id="addTab" class="fa fa-plus"></i></div>'),jQuery.fn.btnToggle=function(e,t){function o(){e(),i.one("click",n)}function n(){t(),i.one("click",o)}var i=$(this[0]);i.one("click",o)},$("#tabMenu #addTab").btnToggle(function(){},function(){}))}}),$().w2layout({name:"code_editor",panels:[{type:"main",content:"main",tabs:{active:"tab1",name:"tabs",tabs:[{id:"tab0",caption:"Main"}],onClick:function(e){t.setActiveTab(e)}}},{type:"bottom",size:"100px",resizable:!0,hidden:!1,content:'<div id = "console_wrapper"> <div id = "console"></div><div id = "console_input"><span>></span> <input type="text" name="fname" style=""> </div> </div>'}]}),$().w2layout({name:"right_bar",panels:[{type:"main",size:"70%",resizable:!0,content:'<div id = "sidebar_container"><li id = "opts> </li></div>'},{type:"bottom",size:"30%",resizable:!0,hidden:!1,content:"bottom"}]}),$("#grid").w2grid({name:"grid",url:"",onRender:function(){},columns:[{field:"file_name",caption:"File Name",size:"70%"},{field:"file_size",caption:"File Size",size:"30%"}],onClick:function(e,o){var n=currentProject.url,i=w2ui.grid.records[o.recid].file_name,a=n+i;$.get(a,function(e){t.addTabAndCode(i,e)},"text")}}),w2ui.right_bar.content("bottom",w2ui.grid),w2ui.layout.content("main",w2ui.code_editor),w2ui.layout.content("right",w2ui.right_bar),w2ui.code_editor.content("main",'<pre id="editor"></pre>'),w2ui.code_editor.on("resize",function(e,o){console.log("onresize "+e),o.onComplete=function(){t.protoEvent.send("editor_resize"),setTimeout(function(){t.dropboxEnabled=!0,t.bindUpload()},500),setTimeout(function(){$("#toolbar").addClass("show")},500),setTimeout(function(){$("#overlay #toggle").addClass("show")},1e3),setTimeout(function(){$("#container").addClass("on")},700)}}),$(document).unbind("keydown").bind("keydown",function(e){var t=!1;if(8===e.keyCode){var o=e.srcElement||e.target;t="INPUT"===o.tagName.toUpperCase()&&("TEXT"===o.type.toUpperCase()||"PASSWORD"===o.type.toUpperCase()||"FILE"===o.type.toUpperCase())||"TEXTAREA"===o.tagName.toUpperCase()?o.readOnly||o.disabled:!0}t&&e.preventDefault()}),function(e){navigator.userAgent.match(/Macintosh/)&&navigator.userAgent.match(/Chrome/)&&e(window).mousewheel(function(t,o,n,i){if("undefined"!=typeof _){var a,r;a=0>n&&!_(e(t.target).parents()).detect(function(t){return e(t).scrollLeft()>0}),r=i>0&&!_(e(t.target).parents()).detect(function(t){return e(t).scrollTop()>0}),(a||r)&&t.preventDefault()}})}(jQuery);var o=!1;$("#toolbar #newProjectBtn").click(function(){e()}),$("#toolbar #saveBtn").click(function(){$.isEmptyObject(currentProject)?e():t.protoEvent.send("editor_saveCode")}),$("#toolbar #runBtn").click(function(){$.isEmptyObject(currentProject)?e():t.protoEvent.send("editor_runApp",currentProject)}),$("#toolbar #sideBarBtn").click(function(){w2ui.layout.toggle("right",!1)}),$("#overlay #toggle").click(function(){o?t.protoEvent.send("dashboard_visible",!1):t.protoEvent.send("dashboard_visible",!0),o^=!0}),$("#toolbar #projectsBtn").click(function(){t.showProjects()}),-1!=location.hash.indexOf("#dashboard")&&(console.log("lala"),setTimeout(function(){t.protoEvent.send("dashboard_visible",!0)},1e3)),-1!=location.hash.indexOf("#project"),$("#console_wrapper input").keydown(function(e){var o=e.which;if(13==o){console.log("enter");var n=$("#console_wrapper input").val();consoleInputHistory.push(n),t.protoEvent.send("liveExecute",n),$("#console_wrapper input").val(""),currentHistoryEntry=consoleInputHistory.length,e.preventDefault()}38==o&&(currentHistoryEntry>0&&currentHistoryEntry--,$("#console_wrapper input").val(consoleInputHistory[currentHistoryEntry])),40==o&&(consoleInputHistory.length>currentHistoryEntry&&currentHistoryEntry++,$("#console_wrapper input").val(consoleInputHistory[currentHistoryEntry]))}),$(document).unbind("keydown").bind("keydown",function(e){var t=!1;if(8===e.keyCode){var o=e.srcElement||e.target;t="INPUT"===o.tagName.toUpperCase()&&("TEXT"===o.type.toUpperCase()||"PASSWORD"===o.type.toUpperCase()||"FILE"===o.type.toUpperCase())||"TEXTAREA"===o.tagName.toUpperCase()?o.readOnly||o.disabled:!0}t&&e.preventDefault()}),this.initEvents()},Ui.prototype.bindUpload=function(){var e=this;$("#layout_right_bar_panel_bottom #grid_grid_records").on("dragenter",function(t){console.log("lalallaala"),console.log(t.target),1==e.dropboxEnabled&&(e.initUpload(),t.preventDefault(),t.stopPropagation())}),$("#grid_grid_records").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),$("#grid_grid_records").on("drop",function(e){e.preventDefault(),e.stopPropagation()}),$("#grid_grid_records").on("dragend",function(){})};var consoleInputHistory=[],currentHistoryEntry;Ui.prototype.showProjectsStatus=!1,Ui.prototype.showProjects=function(){0==this.showProjectsStatus?($("#list_projects").addClass("show"),$("#toolbar #projectsBtn").addClass("on")):($("#list_projects").removeClass("show"),$("#toolbar #projectsBtn").removeClass("on")),this.showProjectsStatus^=!0},Ui.prototype.toolbarFeedback=function(e){var t;"save"===e?t="#saveBtn":"run"===e&&(t="#runBtn"),$("#toolbar "+t).addClass("on"),setTimeout(function(){$("#toolbar "+t).removeClass("on")},500)},Ui.prototype.appRunningStatus=!1,Ui.prototype.appRunning=function(e){e?$("#runBtn").addClass("app_running").removeClass("app_connected").find("span").text("close"):$("#runBtn").addClass("app_connected").removeClass("app_running").find("span").text("run"),this.appRunningStatus=e},Ui.prototype.appConnectedStatus=!1,Ui.prototype.appConnected=function(e){e?$("#runBtn").addClass("app_connected"):$("#runBtn").removeClass("app_connected").removeClass("app_running"),this.appConnectedStatus=e},Ui.prototype.setProjectList=function(e,t){var o=this,n=e;"examples"==e?listExamples=t.projects:"projects"==e&&(listProjects=t.projects),$("#list_projects #"+n+" ul").empty();var i={};i.items=[],$(t.projects).each(function(t,a){$('<li id ="'+a.name+'"><span>'+a.name+'</span><div id ="actions"> <div id ="cont"> <i id = "rename" class="fa fa-pencil"></i> <i id = "delete" class="fa fa-trash-o"> </i>   </div> </div> </li>').click(function(){currentProject=a,currentProject.type=e,o.protoEvent.send("fetchCode",{name:a.name,type:a.type}),o.showProjects(!1),$("#list_projects #"+a.name+" #rename").click(function(e){o.protoEvent.send("renameProject",a),e.stopPropagation()}),$("#list_projects #"+a.name+" #delete").click(function(e){o.protoEvent.send("removeApp",a),e.stopPropagation()
})}).hover(function(){o.protoEvent.send("deviceProjectHighlight",{filter:e,projectName:a.name})}).appendTo("#list_projects #"+n+" ul"),i.items.push(a.name)}),currentObject=i},Ui.prototype.loadHTMLRightBar=function(e){$("#reference_container #content").load(e).fadeIn("500")},Ui.prototype.resetTabs=function(){var e=w2ui.code_editor,t=e.get("main");t.tabs.add([{id:"tab0",caption:"Main",closable:!1}]),this.tabs={},this.tabId=0},Ui.prototype.addTabAndCode=function(e,t){var o=w2ui.code_editor,n=o.get("main");n.tabs.add([{id:"tab"+this.tabId,caption:e,closable:!0,onDblClick:function(e){console.log(e)}}]),n.tabs.active="tab"+this.tabId,n.tabs.refresh(),protocoder.event.send("editor_setTypeAndCode",{type:e,code:t}),this.tabs[e]={},this.tabs[e].id="tab"+this.tabId,this.tabId++,this.tabs[e].code=t},Ui.prototype.getTabNameById=function(e){for(i in this.tabs)if(this.tabs[i].id==e)return i},Ui.prototype.textChanged=function(){},Ui.prototype.removeTab=function(e){var t=w2ui.code_editor,o=t.get("main");o.tabs.remove(e)},Ui.prototype.removeAllTabs=function(){var e=w2ui.code_editor,t=e.get("main");for(i in this.tabs){var o=this.tabs[i].id;"tab0"!=o&&t.tabs.remove(o)}},Ui.prototype.setMainTab=function(e,t){this.removeAllTabs();var o=w2ui.code_editor.get("main").tabs;o.get("tab0").caption=e,o.active="tab0",o.refresh(),this.tabs={},this.tabId=0,this.tabs[e]={},protocoder.event.send("editor_setTypeAndCode",{type:"main.js",code:t}),this.tabs[e].id="tab"+this.tabId,this.tabId++,this.tabs[e].code=t,this.tabs[e].name="main.js",this.activeTab=this.tabs[e]},Ui.prototype.setActiveTab=function(e){var t=w2ui.code_editor,o=t.get("main");o.tabs.active=e,o.tabs.refresh();var n,i=this.getTabNameById(e);this.tabs[i]?(this.activeTab=this.tabs[i],n=this.tabs[i].code,this.tabs[i].name=i,"tab0"===e&&(this.tabs[i].name="main.js")):n="",this.protoEvent.send("editor_setTypeAndCode",{name:i,code:n})},Ui.prototype.getActiveTab=function(){return this.activeTab},Ui.prototype.getOpenTabs=function(){return this.tabs},Ui.prototype.clearFileElements=function(){var e=this;w2ui.grid.clear(),setTimeout(function(){e.bindUpload()},500)},Ui.prototype.addFileElement=function(e){w2ui.grid.add(e)},Ui.prototype.setTabFeedback=function(){},Ui.prototype.openNewWindow=function(){window.open("http://192.168.1.100:8585","_blank","toolbar=no, location=no, status=no, resizable=yes, width=500, height=500, left=10, top=10")},Ui.prototype.consoleLog=function(e){self.countLogs>1e3&&($("#console_wrapper #console p").slice(0,100).remove(),self.countLogs-=100),$("#console_wrapper #console").append(e);var t=$("#console_wrapper #console")[0];t.scrollTop=t.scrollHeight,self.countLogs++},Ui.prototype.initUpload=function(){function e(e){var t=$(i),a=new FileReader;a.readAsDataURL(e),n.hide(),t.appendTo(o),$.data(e,t)}function t(e){n.html(e)}if(that=this,this.dropboxEnabled=!1,$("#dropbox").remove(),"undefined"!=currentProject.name){$("#grid_grid_records").append('<div id = "dropbox"> </div>');var o=$("#dropbox"),n=$(".message",o);o.filedrop({paramname:"pic",maxfiles:100,maxfilesize:25,url:"./?name="+currentProject.name+"&fileType="+currentProject.type,uploadFinished:function(e,t){$.data(t).addClass("done"),that.protoEvent.send("listFilesInProject",currentProject),$("#grid_grid_records #dropbox").remove(),that.dropboxEnabled=!0},dragEnter:function(){},dragOver:function(){$("#dropbox").css("background-color","rgba(255, 0, 0, 0.5);")},dragLeave:function(){$("#dropbox").css("background-color","rgba(0, 0, 0, 0.1);"),$("#grid_grid_records #dropbox").remove(),that.dropboxEnabled=!0},error:function(e,o){switch(e){case"BrowserNotSupported":t("Your browser does not support HTML5 file uploads!");break;case"TooManyFiles":alert("Too many files! Please select 10 file at most!");break;case"FileTooLarge":alert(o.name+" is too large! Please upload files up to 5mb.");break;default:}},beforeEach:function(){},uploadStarted:function(t,o){e(o)},progressUpdated:function(e,t,o){$.data(t).find(".progress").width(o)}});var i='<div class="preview"><div class="progressHolder"><div class="progress"></div></div></div>'}};